## Generate the [[dbt]] models using [[Python Click]]

#### 1. `modgen ls`
- Command  
```bash
modgen ls  
```  

- Example  
```bash
$ modgen ls  
./models/datavault/stage/stage_2_hashdiff/optomate/stage_optomate_2000_060_patient.sql.gen  
./models/datavault/stage/stage_1_pre/sales_force/pre_stage_sales_force_${SOURCE_ID}_ticket.sql.gen  
./models/datavault/stage/stage_1_pre/optomate/pre_stage_optomate_${SOURCE_ID}_patient.sql.gen  
-- 3 templates found  
```## Check the config  
Find the config and perform checks  
Example  
```  

#### 2. `modgen debug`
- Command
```bash
modgen debug
```

- Example 
```bash  
$ modgen debug --config-file=./config/modgen.yml  
found config at ./config/modgen.yml  
( dump of config read as YAML and output as dict)

```## Generate the Models  

Example  

```  

#### 3. `modgen generate`
- Command
```bash
modgen generate
```

- Command
```bash
modgen generate --full-refresh
```

- Example
```bash
$ modgen generate  
found config at ./config/modgen.yml  
1. ./models/datavault/stage/stage_2_hashdiff/optomate/stage_optomate_2000_060_patient.sql.gen  
1.1 output to ./optomate_2000_060/stage_optomate_2000_060_patient.sql  
1.2 output to ./optomate_4507_123/stage_optomate_4507_123_patient.sql  
1.3 output to ./optomate_8022_123/stage_optomate_8022_123_patient.sql  

2. ./models/datavault/stage/stage_1_pre/sales_force/pre_stage_sales_force_${SOURCE_ID}_ticket.sql.gen  
2.1 output to ./sales_force/pre_stage_sales_force_123_ticket.sql.  
2.2 output to ./sales_force/pre_stage_sales_force_456_ticket.sql. 
2.3 output to ./sales_force/pre_stage_sales_force_789_ticket.sql. 

3. ./models/datavault/stage/stage_1_pre/optomate/pre_stage_optomate_${SOURCE_ID}_patient.sql.gen  
3.1 output to ./
3.1 output to ./
3.1 output to ./

```

Using [[MD5-hash]] to checking the .sql.gen file and create the modgen_manifest.json

##### 4. `Defaults`
- config-file-path = ./modgen.yml 
- manifest-file-path = ./modgen_manifest.json
- header:  at top of each file  
```bash
-- THIS FILE IS GENERATED BY MODGEN --  
-- Generated: Date  
```

- output path : `./(gen)`  
- file_name_template: JINJA ie. `${}`
- embedded config in file:  
	- `start_config`: `-- START MODGEN-CONFIG-YAML --`  
	- `end_config`: `-- END MODGEN-CONFIG-YAML --`
	
```bash
-- START MODGEN-CONFIG-YAML --  
-- config:  
--   replacements:  
--     - find_regex: (?i)Optomate_2000_06  
--       replace: ${SOURCE_ID}  
--   output_path: ./$SOURCE_ID  
-- END MODGEN-CONFIG-YAML --  
```

##### `Manifest`:
A manifest JSON file will be created each time new model is generated containing a hash of the template file so that :  
- subsequent `modgen generate` calls will only generate models where source files have changed  
- there is a record of generated files
```json  
{  
generated: [  
{  
// relative path to template,  
path: "./models/datavault/stage/stage_2_hashdiff/optomate/stage_optomate_2000_060_patient.sql.gen",  
hash: "1cac5d3c740ef4ba38374c5bafc9e1c9", // MD5 has of the file contents  
lastGenerated: "Wed Aug 23 2023 18:31:08 GMT+1000", // datetime of last generation  
target: "./models/datavault/stage/stage_2_hashdiff/optomate/(gen)/stage_optomate_2000_060_patient.sql  
}  
]  
}  
```

